---

- name: ansible-virtualization-guest | vm | vm xml
  virt:
    name: "{{ vm.name }}"
    command: get_xml
  register: vmxml

- name: ansible-virtualization-guest | vm | Debug vminfo
  debug:
    var: vmxml
    verbosity: 1

- name: ansible-virtualization-guest | vm | loop over nics
  include_tasks: network.yml
  loop: "{{ vm.interfaces }}"
  loop_control:
    loop_var: nic

- name: ansible-virtualization-guest | vm | add newly created guest to configured guests
  set_fact:
    ansible_virtualization_guest_configuredvms: "{{ ansible_virtualization_guest_configuredvms | union([ vm.name ]) | unique }}"
