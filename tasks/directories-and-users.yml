---

- name: Get current user.
  ansible.builtin.command: whoami
  changed_when: false
  become: false
  register: whoami

- name: ansible-virtualization-guest | debug whoami
  ansible.builtin.debug:
    var: whoami
    verbosity: 2

- name: ansible-virtualization-guest | debug environment user
  ansible.builtin.debug:
    msg: "{{ lookup('env', 'USER') }}"
    verbosity: 2

- name: ansible-virtualization-guest | ensure ssh directory is here
  ansible.builtin.file:
    path: "/home/{{ whoami.stdout }}/.ssh"
    state: directory
    owner: "{{ whoami.stdout }}"
    group: "{{ whoami.stdout }}"
    mode: '0700'

- name: ansible-virtualization-guest | persistent-facts | Create etc/ansible (may throw exception if fact_path is configured)
  ansible.builtin.file:
    path: "{{ fact_path | default('/etc/ansible') }}"
    state: directory
    mode: '0755'
  become: true

- name:  ansible-virtualization-guest | persistent-facts | Create fact directory
  ansible.builtin.file:
    path: "{{ fact_path | default('/etc/ansible/facts.d') }}"
    state: directory
    mode: '0755'
  become: true
