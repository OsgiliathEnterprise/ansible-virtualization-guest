---
# tasks file for ansible-users

- name: ansible-users | loop over users_group_list for local users
  include: local-groups.yml
  when:
    - local_users_group_list is defined

- name: ansible-users | loop over users_user_list for local users
  include: local-users.yml
  when:
    - local_users_user_list is defined

- name: ansible-users | loop over systemusers_user_list
  include: system-users.yml
  loop: "{{ local_systemusers_user_list }}"
  loop_control:
    label: "{{ user.name }}"
    loop_var: user
  when:
    - local_systemusers_user_list is defined

- name: ansible-users | include secure host group if needed
  include_role:
    name: tcharl.ansible_securehost
  when:
    - ipa_users_user_list is defined or ipa_users_group_list is defined
    - idm_group | default("") | string in group_names

- name: ansible-users | loop over ipa_users_group_list
  include: ipa-groups.yml
  loop: "{{ ipa_users_group_list }}"
  loop_control:
    label: "{{ group.name }}"
    loop_var: group
  when:
    - idm_group | default("") | string in group_names
    - ipa_users_group_list is defined

- name: ansible-users | loop over ipa_users_user_list
  include: ipa-users.yml
  loop: "{{ ipa_users_user_list }}"
  loop_control:
    label: "{{ user.name }}"
    loop_var: user
  when:
    - idm_group | default("") | string in group_names
    - ipa_users_user_list is defined
